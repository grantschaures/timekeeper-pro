import{dailyDay as a,dailyDate as r,rightDailyArrow as i,rightDailyArrowGray as s,leftDailyArrow as e,miniChartLabels as o,miniChartContainers as T,dailyBlocks as t,calendarIconContainer as l,calendarPopup as n,monthSelection as d,yearSelection as c,calendarHeaderCells as u,leftCalendarArrow as y,rightCalendarArrow as m,rightCalendarArrowGray as f,calendarBody as h,todayBtn as O,sessionViewBackBtn as p}from"../modules/dashboard-elements.js";import{dailyContainer as D,general as w,flags as v,calendarContainer as x}from"../modules/dashboard-objects.js";import{tempCounters as j}from"../modules/index-objects.js";import{sessionState as W}from"../modules/state-objects.js";import{setBounds as V,alterBounds as Y,setRightArrowType as F}from"./label-distribution.js";function checkViewportWidth(){865<=window.innerWidth&&window.innerWidth<=1050?(a.style.fontSize="22px",r.style.fontSize="14px",d.style.fontSize="12px",c.style.fontSize="12px",d.style.width="90px",c.style.width="65px",u.forEach(e=>{e.style.fontSize="14px"})):(a.style.fontSize="24px",r.style.fontSize="16px",d.style.fontSize="14px",c.style.fontSize="14px",d.style.width="100px",c.style.width="70px",u.forEach(e=>{e.style.fontSize="16px"}))}function g(e){B(e),document.dispatchEvent(new Event("displayDayView")),v.sessionViewContainerShowing&&p.click()}function updateDailyContainer(e){D.selectedDate=e,v.sessionViewContainerShowing&&p.click(),k();e=C();z(),B(e),document.dispatchEvent(new Event("displayMiniCharts")),v.calendarPopupShowing&&l.click()}function C(){var[e,t,n]=D.selectedDate.split("-").map(Number);return new Date(e,t-1,n).getDay()}function k(){var e=moment(D.selectedDate,"YYYY-MM-DD"),t=moment(w.currentDay,"YYYY-MM-DD"),n=e.clone().startOf(D.timeFrame).format("YYYY-MM-DD"),e=e.clone().endOf(D.timeFrame).format("YYYY-MM-DD");D.lowerBound=n,D.upperBound=e,F(D,t,i,s)}function P(e,t,n){return e+`-${t=E(t)?S(t,0):t}-`+(n=E(n)?S(n,0):n)}function S(e,t){return t.toString()+e.toString()}function E(e){return-9<=e&&e<=9}function M(e){var t=A(w.currentDay),n=t.year;"monthChange"===e?(x.month=parseInt(d.value),L(n),b(n)):"yearChange"===e?(parseInt(c.value)>n?c.value=n:parseInt(c.value)<1e3&&(c.value=1e3),x.year=parseInt(c.value),L(n),b(n)):"shiftDown"===e?(1===x.month?(x.month=12,x.year--):x.month--,d.value=x.month,c.value=x.year,L(n)):"shiftUp"===e&&(12===x.month&&x.year<n?(x.month=1,x.year++):x.month++,d.value=x.month,c.value=x.year,b(n)),I(t)}function I(t){var n=x.month,a=x.year,r=U(n,a),i=J(n,a),s=document.querySelectorAll(".calendarCell"),e=A(D.selectedDate),o=e.month,l=e.year,d=e.day;x.selectedCellId=null;let c=0;for(let e=0;e<s.length;e++)s[e].classList="no-select calendarCell",s[e].textContent="",n===o&&a===l&&c+1===d&&(s[e].classList.add("selectedDay"),x.selectedCellId=s[e].id),e<i||c>=r.length?s[e].classList.add("invisible"):(a===t.year&&(n===t.month?c+1===t.day?s[e].classList.add("currentDay"):c+1>t.day&&s[e].classList.add("unselectable"):n>t.month&&s[e].classList.add("unselectable")),s[e].textContent=r[c],c++)}function J(e,t){return new Date(t,e-1,1).getDay()}function U(e,t){var n=new Date(t,e,0).getDate(),a=[];for(let e=1;e<=n;e++)a.push(e);return a}function L(e){(x.month<12||x.year<e)&&(m.style.display="flex",f.style.display="none")}function b(e){12===x.month&&x.year===e&&(m.style.display="none",f.style.display="flex")}function B(e){D.selectedDate=D.weeklyDatesArr[e];var t=G();a.innerText=t.dayOfWeek,r.innerText=t.monthDayYear,o[D.weekIndex].style.textDecoration="",o[D.weekIndex].style.fontSize="9px",o[e].style.textDecoration="underline",o[e].style.fontSize="11px",D.weekIndex=e}function G(){var e=D.selectedDate,e=moment(e,"YYYY-MM-DD");return{dayOfWeek:e.format("dddd"),monthDayYear:e.format("MMMM D, YYYY")}}function z(){var t=N();for(let e=0;e<7;e++)o[e].textContent=t[e];var e=D.weeklyDatesArr,n=D.selectedDate;e.includes(n)?(o[D.weekIndex].style.textDecoration="underline",o[D.weekIndex].style.fontSize="11px"):(o[D.weekIndex].style.textDecoration="",o[D.weekIndex].style.fontSize="9px")}function N(){var e=moment(w.currentDay,"YYYY-MM-DD"),t=moment(D.upperBound,"YYYY-MM-DD"),n=moment(D.lowerBound,"YYYY-MM-DD");let a=[];for(var r=[],i=[];n.isSameOrBefore(t);){var s=n.format("YYYY-MM-DD");i.push(s),r.push($(s)),n.add(1,"days")}return D.weeklyDatesArr=i,a=e.isSameOrBefore(t)?["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]:r}function $(e){var[,e,t]=e.split("-");return parseInt(e)+"/"+parseInt(t)}async function setInitialDate(){var e,t,n;v.remainOnSelectedDate||(e=new Date,D.selectedDate=w.currentDay,n=A(w.currentDay),x.month=n.month,x.year=n.year,c.value=x.year,c.max=x.year,d.value=x.month,I(n),n=["January","February","March","April","May","June","July","August","September","October","November","December"],t=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][e.getDay()],n=n[e.getMonth()]+` ${e.getDate()}, `+e.getFullYear(),a.innerText=t,r.innerText=n,D.dayViewSummaryChartSeen&&(o[D.weekIndex].style.textDecoration="",o[D.weekIndex].style.fontSize="9px"),D.weekIndex=C(),await V(D,null,i,s),z()),document.dispatchEvent(new Event("displayMiniCharts")),v.remainOnSelectedDate=!1}function A(e){var[e,t,n]=e.split("-");return{month:parseInt(t),year:parseInt(e),day:parseInt(n)}}document.addEventListener("DOMContentLoaded",function(){window.addEventListener("resize",checkViewportWidth)}),document.addEventListener("stateUpdated",function(){setInitialDate(),W.loggedIn&&(e.addEventListener("click",function(){Y("shiftdown",D,null,i,s),z(),v.dailyArrowClicked=!0,document.dispatchEvent(new Event("displayMiniCharts"))}),i.addEventListener("click",function(){Y("shiftup",D,null,i,s),z(),v.dailyArrowClicked=!0,document.dispatchEvent(new Event("displayMiniCharts"))}),t[0].addEventListener("click",function(){g(0)}),t[1].addEventListener("click",function(){g(1)}),t[2].addEventListener("click",function(){g(2)}),t[3].addEventListener("click",function(){g(3)}),t[4].addEventListener("click",function(){g(4)}),t[5].addEventListener("click",function(){g(5)}),t[6].addEventListener("click",function(){g(6)}),l.addEventListener("click",function(){var e=window.innerWidth||document.documentElement.clientWidth;v.calendarPopupShowing?(v.calendarPopupShowing=!1,n.style.opacity="0",n.style.transform="scale(0.90)",setTimeout(()=>{n.style.display="none"},150),5===j.dashboardCatIdsArrIndex&&(document.getElementById("dashboardCat6").style.display="flex")):(v.calendarPopupShowing=!0,n.style.display="flex",setTimeout(()=>{n.style.opacity="1",n.style.transform="scale(1)"},0),e<=670&&(document.getElementById("dashboardCat6").style.display="none"),I(A(w.currentDay)))}),d.addEventListener("change",function(){M("monthChange")}),c.addEventListener("change",function(){M("yearChange")}),y.addEventListener("click",function(){M("shiftDown")}),m.addEventListener("click",function(){M("shiftUp")}),h.addEventListener("click",function(e){var t=e.target.classList.value,e=e.target.id,n=x.selectedCellId;"no-select calendarCell"!==t&&"no-select calendarCell currentDay"!==t||(v.sessionViewContainerShowing&&p.click(),n&&n!==e&&document.getElementById(n).classList.remove("selectedDay"),document.getElementById(e).classList.add("selectedDay"),x.selectedCellId=e,t=document.getElementById(e).innerText,D.selectedDate=P(x.year,x.month,t),k(),n=C(),z(),B(n),document.dispatchEvent(new Event("displayMiniCharts")),l.click())}),O.addEventListener("click",function(){setInitialDate(),l.click(),v.sessionViewContainerShowing&&p.click()}))});export{checkViewportWidth,updateDailyContainer,setInitialDate};