import{dashboardData as o}from"../modules/dashboard-objects.js";import{timeConvert as s}from"../modules/index-objects.js";import{populateDashboardSummaryStats as a}from"./summary-stats.js";import{populateLabelDistContainer as i}from"./label-distribution.js";import{setMainChartsContainer as n}from"./metric-charts.js";async function populateDashboard(e,r){var t=await m(e);await l(e,t,r),a(s,t,o),i(),n()}async function l(e,r,t){o.sessionArr=e,o.dailyArr=r,o.noteData=t}async function m(e){return r(u(e),e)}function r(e,o){let s={};return e.forEach(e=>{var r=moment(e.date).format("YYYY-MM-DD"),{deepWorkTime:e,distractions:t,inDeepWork:a}=e.data;s[r]||(s[r]={date:r,deepWorkTime:0,distractions:0,inDeepWork:!1,deepWorkIntervals:[],breakIntervals:[],labelTimes:{}},p(r,o,s)),s[r].deepWorkTime+=e,s[r].distractions+=t,a&&(s[r].inDeepWork=!0)}),t(Object.values(s))}function t(e){return e.sort((e,r)=>{return new Date(e.date)-new Date(r.date)})}function u(e){let a=[];return e.forEach(e=>{let{timeZone:t,perHourData:r}=e;Object.entries(r).forEach(([e,r])=>{e=moment.tz(e,t).format(),a.push({date:e,data:r}),e=d(e);r.inDeepWork&&(o.hourlyArr[e].focusQualities.push(focusQualityCalculation(s,r.deepWorkTime,r.distractions,.5)),o.hourlyArr[e].distractionsPerHour.push(calculateDistractionsPerHour(s,r.deepWorkTime,r.distractions)),o.hourlyArr[e].deepWorkTimes.push(r.deepWorkTime),o.hourlyArr[e].deepWork+=r.deepWorkTime,o.hourlyArr[e].distractions+=r.distractions)})}),a}function d(e){var e=e.match(/T(\d{2}):/);return e?(e=e[1],parseInt(e,10)):null}function calculateDistractionsPerHour(e,r,t){t=t*e.msPerHour/r;return Math.round(10*t)/10}function focusQualityCalculation(e,r,t,a){r/=e.msPerMin;let o;return(o=0<r?1-t/r/a:0)<0?o=0:isNaN(o)&&(o=1),o=parseFloat(o.toFixed(2))}function p(e,r,t){for(var a of r)if(moment.tz(a.startTime,a.timeZone).format().split("T")[0]==e){for(var o of a.deepWorkIntervals)t[e].deepWorkIntervals.push(o);for(var s of a.breakIntervals)t[e].breakIntervals.push(s);if(0===Object.keys(t[e].labelTimes).length)t[e].labelTimes={...a.labelTimes};else for(var i in a.labelTimes)t[e].labelTimes.hasOwnProperty(i)?t[e].labelTimes[i]+=a.labelTimes[i]:t[e].labelTimes[i]=a.labelTimes[i]}return!1}export{populateDashboard,calculateDistractionsPerHour,focusQualityCalculation};