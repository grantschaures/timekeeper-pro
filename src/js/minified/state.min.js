import{pomodoroNotificationToggle as t,pomodoroInputs as n,autoStartPomodoroIntervalToggle as o,autoStartBreakIntervalToggle as a,pomodoroVolumeThumb as s,pomodoroVolumeThumb2 as i,pomodoroRadios as l,flowmodoroNotificationToggle as M,flowmodoroInputs as D,flowmodoroVolumeThumb as H,flowmodoroVolumeThumb2 as U,flowmodoroRadios as c,breakSuggestionToggle as F,suggestionMinutesInput as _,generalRadios as d,targetTimeReachedToggle as q,darkGrayTheme as r,defaultTheme as m,interruptionsContainer as u,targetHoursContainer as g,timekeepingContainer as f,progressBarContainer as h,popupMenu as T,settingsContainer as k,notesContainer as p,aboutContainer as I,blogContainer as y,emojiContainer as b,flowTimeAnimationToggle as G,chillTimeAnimationToggle as W,transitionClockSoundToggle as z,labelSelectionRow as B,emojiImg as J,emojiImg2 as K,dynamicList as Q,propagateUnfinishedTasksToggle as X,blackFlowtimeBackground as Y,blackChilltimeBackground as Z,total_time_display as $,streaksContainer as v}from"../modules/dom-elements.js";import{sessionState as C}from"../modules/state-objects.js";import{flags as E,timeAmount as w,alertVolumes as S,alertSounds as A,selectedBackgroundId as L,selectedBackground as x,flowtimeBackgrounds as ee,chilltimeBackgrounds as te,selectedBackgroundIdTemp as j,startTimes as oe,elapsedTime as ne,timeConvert as ae,progressTextMod as N}from"../modules/index-objects.js";import{flags as V,counters as P,state as R,labelDict as O,notesArr as se}from"../modules/notes-objects.js";import{updateStreak as ie}from"../utility/update_streaks.js";import{setInitialBackgroundCellSelection as le,setBackground as e,deactivateDarkTheme as ce,activateDarkTheme as de,replaceTargetHours as re,totalTimeDisplay as me}from"../main/index.js";import{appendEditRemoveContainer as ue,createCheckElements as ge,getLastNumberFromId as fe}from"../main/notes.js";var he=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);function Te(){fetch("/api/state/sessionValidation",{method:"POST",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{ke(e)}).catch(e=>{})}async function ke(e){e.isLoggedIn&&(C.loggedIn=!0,C.updatingState=!0,await pe(e.user,e.note),C.updatingState=!1)}async function pe(e,t){be(),Be(e),ve(e),Ce(e),ie(e),Ie(e),ye(e),Ye(t),Ze(t)}function Ie(e){e=e.showingTimeLeft;N.showingTimeLeft=e}function ye(e){e=e.targetHours;void 0!==e&&(w.targetTime=60*e*60*1e3,re(e,w,E),me(oe,ne,$,ae,E,w,N))}function be(){document.getElementById("loginIcon").style.display="none",document.getElementById("logoutIcon").style.display="flex",document.getElementById("logInOutBtn").innerText="Log Out"}function Be(e){document.getElementById("loginIcon2").style.display="none",document.getElementById("accountIconFinal").style.display="flex",document.getElementById("logInOutBtn2").innerText=e.email,document.getElementById("questionPopupUserEmail").innerText=e.email,e.logins<=1?document.getElementById("welcomeText").innerText="Welcome! ðŸ˜„":document.getElementById("welcomeText").innerText="Welcome Back! ðŸ˜„"}function ve(e){["noAccountText","accountOr1","settingsGoogleLogin","accountOr2","emailPasswordLoginMainContainer","loginBtnContainer"].forEach(e=>document.getElementById(e).style.display="none"),["userEmailContainer","logoutBtnContainer","accountHr","deleteAccountBtnContainer"].forEach(e=>document.getElementById(e).style.display="flex"),document.getElementById("userEmail").innerText=e.email}function Ce(e){Ee(e),je(e),Oe(e),_e(e),ze(e),Qe(e)}function Ee(e){we(e),Se(e),Ae(e),Le(e),xe(e)}function we(e){e=e.settings.pomodoro.notificationToggle;E.pomodoroNotificationToggle=e,t.checked=e}function Se(e){let o=e.settings.pomodoro["intervalArr"];w.pomodoroIntervalArr=o,n.forEach((e,t)=>{e.value=o[t]})}function Ae(e){var{autoStartPomToggle:e,autoStartBreakToggle:t}=e.settings.pomodoro;E.autoStartPomodoroInterval=e,o.checked=e,E.autoStartBreakInterval=t,a.checked=t}function Le(e){e=e.settings.pomodoro.alertVolume;S.pomodoro=e,s.style.left=100*e+"%",i.style.left=100*e+"%"}function xe(e){e=e.settings.pomodoro.alertSound;"none"===(A.pomodoro=e)?(l[0].checked=!0,l[3].checked=!0):"chime"===e?(l[1].checked=!0,l[4].checked=!0):"bell"===e&&(l[2].checked=!0,l[5].checked=!0)}function je(e){Ne(e),Ve(e),Pe(e),Re(e)}function Ne(e){e=e.settings.chillTime.notificationToggle;E.flowmodoroNotificationToggle=e,M.checked=e}function Ve(e){let o=e.settings.chillTime["intervalArr"];w.breakTimeSuggestionsArr=o,D.forEach((e,t)=>{e.value=o[t]})}function Pe(e){e=e.settings.chillTime.alertVolume;S.flowmodoro=e,H.style.left=100*e+"%",U.style.left=100*e+"%"}function Re(e){e=e.settings.chillTime.alertSound;"none"===(A.flowmodoro=e)?(c[0].checked=!0,c[3].checked=!0):"chime"===e?(c[1].checked=!0,c[4].checked=!0):"bell"===e&&(c[2].checked=!0,c[5].checked=!0)}function Oe(e){Me(e),De(e),He(e),Ue(e),Fe(e,q)}function Me(e){e=e.settings.flowTime.notificationToggle;E.breakSuggestionToggle=e,F.checked=e}function De(e){e=e.settings.flowTime.suggestionMinutes;w.suggestionMinutes=e,_.value=e}function He(e){e=e.settings.flowTime.alertVolume;S.general=e,generalVolumeThumb.style.left=100*e+"%",generalVolumeThumb2.style.left=100*e+"%"}function Ue(e){e=e.settings.flowTime.alertSound;"none"===(A.general=e)?(d[0].checked=!0,d[3].checked=!0):"chime"===e?(d[1].checked=!0,d[4].checked=!0):"bell"===e&&(d[2].checked=!0,d[5].checked=!0)}function Fe(e,t){e=e.settings.flowTime.targetTimeReachedToggle;E.targetReachedToggle=e,t.checked=e}function _e(e){qe(e),Ge(e),We(e)}function qe(e){e=e.settings.backgroundsThemes.darkThemeActivated;E.darkThemeActivated=e,E.darkThemeActivated?(r.classList.add("selected-background"),m.classList.remove("selected-background"),de(u,g,f,h,T,k,p,I,y,Y,Z,j,L,b,v)):(r.classList.remove("selected-background"),m.classList.add("selected-background"),ce(u,g,f,h,T,k,p,I,y,j,L,b,he,v))}function Ge(e){var{flowTimeBackground:e,chillTimeBackground:t,flowTimeBackgroundTemp:o,chillTimeBackgroundTemp:n}=e.settings.backgroundsThemes;L.flowtime=e,x.flowtime=ee[e],L.chilltime=t,x.chilltime=te[t],j.flowtime=o,j.chilltime=n,document.getElementById("green-default").classList.remove("selected-background"),document.getElementById("blue-default").classList.remove("selected-background"),le()}function We(e){var{flowTimeAnimation:e,chillTimeAnimation:t}=e.settings.backgroundsThemes;E.flowTimeAnimationToggle=e,G.checked=e,E.chillTimeAnimationToggle=t,W.checked=t}function ze(e){Je(e),Ke(e)}function Je(e){e=e.settings.notes.autoSwitchToggle;V.transitionNotesAutoSwitchToggle=e,transitionNotesAutoSwitchToggle.checked=e}function Ke(e){e=e.settings.notes.propagateUnfinishedTasksToggle;V.propagateUnfinishedTasksToggle=e,X.checked=e}function Qe(e){Xe(e)}function Xe(e){e=e.settings.sounds.transitionClockSound;E.transitionClockSoundToggle=e,z.checked=e}function Ye(e){var t,o,n=B.getElementsByClassName("selection-tag");Array.from(n).forEach(e=>{e.remove(),delete O[e.id]});for([t,o]of Object.entries(e.labels).reverse()){var a=document.createElement("div"),s=(a.id=t,a.className="tag unselectable selection-tag",document.createElement("h4"));s.className="tag-text",s.textContent=o,a.appendChild(s),B.insertBefore(a,B.firstChild),O[a.id]=s.textContent}P.lastLabelIdNum=e.lastLabelIdNum,R.lastSelectedEmojiId=e.lastSelectedEmojiId;n=document.getElementById(R.lastSelectedEmojiId).src;J.src=n,K.src=n}function Ze(e){var t=e.noteTasks;for(let e=0;e<t.length;e++){var o=document.createElement("div"),n=t[e].id,n=(o.id=n,o.setAttribute("data-testid",n),fe(o.id)),a=t[e].classList;for(let e=0;e<a.length;e++)o.classList.add(a[e]);a.includes("task")&&(i=ge({lastTaskInputIdNum:n}),o.appendChild(i),i=o.querySelector("#"+("check"+n)),s=o.firstElementChild,t[e].classList.includes("completed-task"))&&(s.style.backgroundColor="#3ba43e",i.setAttribute("stroke-width","3"),i.parentElement.parentElement.style.opacity="1",o.classList.add("completed-task"));var s=document.createElement("span"),i=(s.textContent=t[e].content,"spanText"+n),n=(s.setAttribute("data-testid",i),o.appendChild(s),ue("Task",n)),n=(o.appendChild(n),Q.appendChild(o),{id:o.id,classList:[...o.classList],content:s.textContent,date:t[e].date});se.push(n)}P.lastTaskInputIdNum=e.lastTaskInputIdNum}document.addEventListener("updateState",()=>{Te()});