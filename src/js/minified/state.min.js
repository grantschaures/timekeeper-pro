import{pomodoroNotificationToggle as t,pomodoroInputs as O,autoStartPomodoroIntervalToggle as V,autoStartBreakIntervalToggle as H,pomodoroVolumeThumb as R,pomodoroVolumeThumb2 as U,pomodoroRadios as o,flowmodoroNotificationToggle as _,flowmodoroInputs as W,flowmodoroVolumeThumb as q,flowmodoroVolumeThumb2 as z,flowmodoroRadios as n,breakSuggestionToggle as G,suggestionMinutesInput as Y,generalRadios as a,targetTimeReachedToggle as Z,darkGrayTheme as s,defaultTheme as i,interruptionsContainer as l,targetHoursContainer as c,timekeepingContainer as r,progressBarContainer as d,popupMenu as m,settingsContainer as g,notesContainer as u,aboutContainer as f,blogContainer as p,emojiContainer as h,flowTimeAnimationToggle as $,chillTimeAnimationToggle as J,transitionClockSoundToggle as K,labelSelectionRow as T,emojiImg as Q,emojiImg2 as X,dynamicList as ee,propagateUnfinishedTasksToggle as te,timestampsToggle as oe,blackFlowtimeBackground as ne,blackChilltimeBackground as ae,total_time_display as se,streaksContainer as k,labelInputContainer as y,tagIcon as ie,promptContainer as b,clearIcon as le,addDoneContainer as ce,tagSelectionDivider as re,taskPrompt as de,intervalTimeToggle as me,totalTimeToggle as ge,muffinToggle as C,lightContainer as ue,darkContainer as fe,transitionNotesAutoSwitchToggle as pe}from"../modules/dom-elements.js";import{sessionState as I}from"../modules/state-objects.js";import{flags as v,timeAmount as E,alertVolumes as w,alertSounds as B,selectedBackgroundId as S,selectedBackground as L,flowtimeBackgrounds as he,chilltimeBackgrounds as Te,selectedBackgroundIdTemp as A,startTimes as ke,elapsedTime as ye,timeConvert as be,progressTextMod as j,darkHtmlBackground as Ce,lightHtmlBackground as Ie}from"../modules/index-objects.js";import{flags as x,counters as D,state as N,labelDict as P,notesArr as ve,selectedLabelDict as Ee,notesFlags as e,fontSizeArr as we,fontNumArr as Be,labelFlags as M,labelArrs as Se}from"../modules/notes-objects.js";import{general as Le}from"../modules/dashboard-objects.js";import{updateStreak as Ae}from"../utility/update-streaks.js";import{userTimeZone as je}from"../utility/identification.js";import{setInitialBackgroundCellSelection as xe,deactivateDarkTheme as De,activateDarkTheme as Ne,replaceTargetHours as Pe,totalTimeDisplay as Me,intervalTimeToggleGUIUpdate as Fe,totalTimeToggleGUIUpdate as Oe}from"../main/index.js";import{appendEditRemoveContainer as Ve,createCheckElements as He,getLastNumberFromId as Re,addLabelInputContainerTagDivider as Ue,addLabelInitialActions as _e,removeTagSelectionDivider as We,adjustLabelFontSize as qe}from"../main/notes.js";import{populateDashboard as ze}from"../dashboard/populate-dashboard.js";var Ge=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);let Ye={path:"url(../fonts/CPMono_v07_Plain.woff)",name:"myFontBlog"},Ze={path:"url(../fonts/CPMono_v07_Bold.woff)",name:"myFont2"},$e={path:"url(../fonts/CPMono_v07_Light.woff)",name:"myFont3"},Je={path:"url(../fonts/TTNormsProRegular.otf)",name:"settingsHeaderFont"};async function Ke(){try{var e,t=await fetch("/api/state/sessionValidation",{method:"GET"});if(t.ok)return Xe(e=await t.json()),e;throw new Error("HTTP error! status: "+t.status)}catch(e){throw e}}function Qe(){var e=moment.tz(Date.now(),je),t=e.format("YYYY"),o=e.format("MM"),e=e.format("DD");Le.currentDay=t+`-${o}-`+e}async function Xe(e){e.isLoggedIn&&(I.loggedIn=!0,I.updatingState=!0,await et(e.user,e.note,e.sessions),I.updatingState=!1)}async function et(e,t,o){nt(),at(e),st(e),it(e),Ae(o),tt(e),ot(e),Vt(t),Ht(t),ze(o,t)}function tt(e){e=e.showingTimeLeft;j.showingTimeLeft=e}function ot(e){e=e.targetHours;void 0!==e&&(E.targetTime=60*e*60*1e3,Pe(e,E,v),Me(ke,ye,se,be,v,E,j),d.classList.toggle("small"),v.progressBarContainerIsSmall=!1)}function nt(){document.getElementById("loginIcon").style.display="none",document.getElementById("logoutIcon").style.display="flex",document.getElementById("logInOutBtn").innerText="Log Out"}function at(e){document.getElementById("loginIcon2").style.display="none",document.getElementById("accountIconFinal").style.display="flex",document.getElementById("logInOutBtn2").innerText=e.email,document.getElementById("questionPopupUserEmail").innerText=e.email,e.logins<=1?document.getElementById("welcomeText").innerText="Welcome":document.getElementById("welcomeText").innerText="Welcome Back"}function st(e){["noAccountText","accountOr1","settingsGoogleLogin","accountOr2","emailPasswordLoginMainContainer","loginBtnContainer"].forEach(e=>document.getElementById(e).style.display="none"),["userEmailContainer","logoutBtnContainer","accountHr","deleteAccountBtnContainer"].forEach(e=>document.getElementById(e).style.display="flex"),document.getElementById("userEmail").innerText=e.email}function it(e){lt(e),ut(e),kt(e),Et(e),Lt(e),Dt(e),Ft(e)}function lt(e){ct(e),rt(e),dt(e),mt(e),gt(e)}function ct(e){e=e.settings.pomodoro.notificationToggle;v.pomodoroNotificationToggle=e,t.checked=e}function rt(e){let o=e.settings.pomodoro["intervalArr"];E.pomodoroIntervalArr=o,O.forEach((e,t)=>{e.value=o[t]})}function dt(e){var{autoStartPomToggle:e,autoStartBreakToggle:t}=e.settings.pomodoro;v.autoStartPomodoroInterval=e,V.checked=e,v.autoStartBreakInterval=t,H.checked=t}function mt(e){e=e.settings.pomodoro.alertVolume;w.pomodoro=e,R.style.left=100*e+"%",U.style.left=100*e+"%"}function gt(e){e=e.settings.pomodoro.alertSound;"none"===(B.pomodoro=e)?(o[0].checked=!0,o[3].checked=!0):"chime"===e?(o[1].checked=!0,o[4].checked=!0):"bell"===e&&(o[2].checked=!0,o[5].checked=!0)}function ut(e){ft(e),pt(e),ht(e),Tt(e)}function ft(e){e=e.settings.chillTime.notificationToggle;v.flowmodoroNotificationToggle=e,_.checked=e}function pt(e){let o=e.settings.chillTime["intervalArr"];E.breakTimeSuggestionsArr=o,W.forEach((e,t)=>{e.value=o[t]})}function ht(e){e=e.settings.chillTime.alertVolume;w.flowmodoro=e,q.style.left=100*e+"%",z.style.left=100*e+"%"}function Tt(e){e=e.settings.chillTime.alertSound;"none"===(B.flowmodoro=e)?(n[0].checked=!0,n[3].checked=!0):"chime"===e?(n[1].checked=!0,n[4].checked=!0):"bell"===e&&(n[2].checked=!0,n[5].checked=!0)}function kt(e){yt(e),bt(e),Ct(e),It(e),vt(e,Z)}function yt(e){e=e.settings.flowTime.notificationToggle;v.breakSuggestionToggle=e,G.checked=e}function bt(e){e=e.settings.flowTime.suggestionMinutes;E.suggestionMinutes=e,Y.value=e}function Ct(e){e=e.settings.flowTime.alertVolume;w.general=e,generalVolumeThumb.style.left=100*e+"%",generalVolumeThumb2.style.left=100*e+"%"}function It(e){e=e.settings.flowTime.alertSound;"none"===(B.general=e)?(a[0].checked=!0,a[3].checked=!0):"chime"===e?(a[1].checked=!0,a[4].checked=!0):"bell"===e&&(a[2].checked=!0,a[5].checked=!0)}function vt(e,t){e=e.settings.flowTime.targetTimeReachedToggle;v.targetReachedToggle=e,t.checked=e}function Et(e){wt(e),Bt(e),St(e)}function wt(e){e=e.settings.backgroundsThemes.darkThemeActivated;v.darkThemeActivated=e,v.darkThemeActivated?(s.classList.add("selected-background"),i.classList.remove("selected-background"),ue.style.display="flex",fe.style.display="none",Ne(l,c,r,d,m,g,u,f,p,ne,ae,A,S,h,k,Ce)):(s.classList.remove("selected-background"),i.classList.add("selected-background"),De(l,c,r,d,m,g,u,f,p,A,S,h,Ge,k,Ie))}function Bt(e){var{flowTimeBackground:e,chillTimeBackground:t,flowTimeBackgroundTemp:o,chillTimeBackgroundTemp:n}=e.settings.backgroundsThemes;S.flowtime=e,L.flowtime=he[e],S.chilltime=t,L.chilltime=Te[t],A.flowtime=o,A.chilltime=n,document.getElementById("green-default").classList.remove("selected-background"),document.getElementById("blue-default").classList.remove("selected-background"),xe()}function St(e){var{flowTimeAnimation:e,chillTimeAnimation:t}=e.settings.backgroundsThemes;v.flowTimeAnimationToggle=e,$.checked=e,v.chillTimeAnimationToggle=t,J.checked=t}function Lt(e){At(e),jt(e),xt(e)}function At(e){e=e.settings.display.intervalTime;me.checked=e,Fe()}function jt(e){e=e.settings.display.totalTime;ge.checked=e,Oe()}function xt(e){e=e.settings.display.muffinToggle;C.checked=e,C.checked?v.muffinToggle=!0:v.muffinToggle=!1}function Dt(e){Pt(e),Mt(e),Nt(e)}function Nt(e){e=e.settings.notes.timestampsToggle;x.timestampsToggle=e,oe.checked=e}function Pt(e){e=e.settings.notes.autoSwitchToggle;x.transitionNotesAutoSwitchToggle=e,pe.checked=e}function Mt(e){e=e.settings.notes.propagateUnfinishedTasksToggle;x.propagateUnfinishedTasksToggle=e,te.checked=e}function Ft(e){Ot(e)}function Ot(e){e=e.settings.sounds.transitionClockSound;v.transitionClockSoundToggle=e,K.checked=e}function Vt(e){var t,o,n,a,s=T.getElementsByClassName("selection-tag");Array.from(s).forEach(e=>{e.remove(),delete P[e.id]});for([t,o]of Object.entries(e.labels).reverse()){var i=document.createElement("div"),l=(i.id=t,document.createElement("h4"));l.className="tag-text",l.textContent=o,i.appendChild(l),e.selectedLabels.hasOwnProperty(t)||(i.className="tag unselectable selection-tag",T.insertBefore(i,T.firstChild)),P[t]=o,M[o]=!1,Se[o]=[]}for([n,a]of Object.entries(e.selectedLabels)){var c=document.createElement("div"),r=(c.id=n,document.createElement("h4"));r.className="tag-text",r.textContent=a,c.appendChild(r),c.className="tag unselectable selected-tag",c.firstElementChild.style.backgroundColor="rgba(255, 255, 255, 0.2)",D.tagsSelected++,Ue(D,y),y.appendChild(c),(y.scrollWidth>y.clientWidth||N.currentLabelInputTagSize<20)&&(qe(N,we,Be,y),y.scrollWidth>y.clientWidth)&&(y.style.justifyContent="left"),Ee[n]=a,M[a]=!0}let d=Rt(P);Object.keys(P).forEach(e=>delete P[e]),Object.keys(d).forEach(e=>P[e]=d[e]),0<D.tagsSelected&&(_e(x,ie,b,le),de.style.display="none",b.style.zIndex=3),We(ce,re,x),D.lastLabelIdNum=e.lastLabelIdNum,N.lastSelectedEmojiId=e.lastSelectedEmojiId;s=document.getElementById(N.lastSelectedEmojiId).src;Q.src=s,X.src=s}function Ht(e){var o=e.noteTasks;for(let t=0;t<o.length;t++){var n=document.createElement("div"),a=o[t].id,a=(n.id=a,n.setAttribute("data-testid",a),Re(n.id)),s=o[t].classList;for(let e=0;e<s.length;e++)n.classList.add(s[e]);var i=document.createElement("span"),l=document.createElement("span"),c=document.createElement("span"),r=document.createElement("span"),d=document.createElement("span");let e="";s.includes("task")&&(g=He({lastTaskInputIdNum:a}),n.appendChild(g),g=n.querySelector("#"+("check"+a)),m=n.firstElementChild,o[t].classList.includes("completed-task"))&&(m.style.backgroundColor="#3ba43e",g.setAttribute("stroke-width","3"),g.parentElement.parentElement.style.opacity="1",n.classList.add("completed-task"),o[t].completionDate)&&(e="---\x3e",r.style.opacity="1",d.style.opacity="1"),i.classList.add("spanContainer"),l.textContent=o[t].content,l.classList.add("spanText");var m="spanText"+a,g=(l.id=m,l.setAttribute("data-testid",m),c.textContent=F(o[t].date),c.classList.add("spanTimestamp"),"spanTimestamp"+a),u=(c.id=g,r.textContent=e,r.classList.add("spanArrow"),"spanArrow"+a),u=(r.id=u,d.textContent=F(o[t].completionDate),d.classList.add("spanCompletion"),"spanCompletion"+a),u=(d.id=u,i.appendChild(l),i.appendChild(c),i.appendChild(r),i.appendChild(d),n.appendChild(i),Ve("Task",a)),c=(n.appendChild(u),ee.appendChild(n),{id:n.id,classList:[...n.classList],content:l.textContent,date:o[t].date,completionDate:o[t].completionDate});ve.push(c)}var t=[document.querySelectorAll(".spanTimestamp"),document.querySelectorAll(".spanArrow"),document.querySelectorAll(".spanCompletion")];x.timestampsToggle||t.forEach(e=>{e.forEach(e=>{e.style.display="none"})}),D.lastTaskInputIdNum=e.lastTaskInputIdNum}function F(e){var t,o;return e?(o=new Date,e=new Date(e),o.getTime()-e.getTime()<864e5&&o.getDate()===e.getDate()?(t=12<=(o=e.getHours())?"pm":"am",(o=(o%=12)||12)+":"+(o=(o=e.getMinutes())<10?"0"+o:o)+" "+t):(o=e.getDate(),e.getMonth()+1+"/"+o+"/"+e.getFullYear().toString().slice(-2))):""}function Rt(e){e=Object.entries(e).reverse();return Object.fromEntries(e)}function Ut(t){for(let e=0;e<t.length;e++)new FontFace(t[e].name,t[e].path).load().then(function(e){document.fonts.add(e)}).catch(function(e){})}document.addEventListener("DOMContentLoaded",()=>{Ut([Ye,Ze,$e,Je]),Qe(),Ke().catch(e=>{}).finally(()=>{document.dispatchEvent(new Event("stateUpdated"))})});