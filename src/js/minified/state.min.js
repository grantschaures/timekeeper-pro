import{pomodoroNotificationToggle as t,pomodoroInputs as n,autoStartPomodoroIntervalToggle as V,autoStartBreakIntervalToggle as M,pomodoroVolumeThumb as R,pomodoroVolumeThumb2 as U,pomodoroRadios as o,flowmodoroNotificationToggle as H,flowmodoroInputs as _,flowmodoroVolumeThumb as W,flowmodoroVolumeThumb2 as G,flowmodoroRadios as a,breakSuggestionToggle as z,suggestionMinutesInput as q,generalRadios as s,targetTimeReachedToggle as J,darkGrayTheme as i,defaultTheme as l,interruptionsContainer as c,targetHoursContainer as r,timekeepingContainer as d,progressBarContainer as m,popupMenu as g,settingsContainer as u,notesContainer as f,aboutContainer as h,blogContainer as T,emojiContainer as p,flowTimeAnimationToggle as K,chillTimeAnimationToggle as Q,transitionClockSoundToggle as X,labelSelectionRow as k,emojiImg as Y,emojiImg2 as Z,dynamicList as $,propagateUnfinishedTasksToggle as ee,blackFlowtimeBackground as te,blackChilltimeBackground as oe,total_time_display as ne,streaksContainer as y,labelInputContainer as b,tagIcon as ae,promptContainer as I,clearIcon as se,addDoneContainer as ie,tagSelectionDivider as le,taskPrompt as ce,intervalTimeToggle as re,totalTimeToggle as de,muffinToggle as v,lightContainer as me,darkContainer as ge}from"../modules/dom-elements.js";import{sessionState as C}from"../modules/state-objects.js";import{flags as E,timeAmount as w,alertVolumes as B,alertSounds as S,selectedBackgroundId as L,selectedBackground as A,flowtimeBackgrounds as ue,chilltimeBackgrounds as fe,selectedBackgroundIdTemp as j,startTimes as he,elapsedTime as Te,timeConvert as pe,progressTextMod as x,darkHtmlBackground as ke,lightHtmlBackground as ye}from"../modules/index-objects.js";import{flags as N,counters as P,state as O,labelDict as F,notesArr as be,selectedLabelDict as Ie,notesFlags as e,fontSizeArr as ve,fontNumArr as Ce,labelFlags as D,labelArrs as Ee}from"../modules/notes-objects.js";import{updateStreak as we}from"../utility/update-streaks.js";import{setInitialBackgroundCellSelection as Be,deactivateDarkTheme as Se,activateDarkTheme as Le,replaceTargetHours as Ae,totalTimeDisplay as je,intervalTimeToggleGUIUpdate as xe,totalTimeToggleGUIUpdate as Ne}from"../main/index.js";import{appendEditRemoveContainer as Pe,createCheckElements as Oe,getLastNumberFromId as Fe,addLabelInputContainerTagDivider as De,addLabelInitialActions as Ve,removeTagSelectionDivider as Me,adjustLabelFontSize as Re}from"../main/notes.js";import{populateDashboard as Ue}from"../dashboard/populate-dashboard.js";var He=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);let _e={path:"url(../fonts/CPMono_v07_Plain.woff)",name:"myFontBlog"},We={path:"url(../fonts/CPMono_v07_Bold.woff)",name:"myFont2"},Ge={path:"url(../fonts/CPMono_v07_Light.woff)",name:"myFont3"},ze={path:"url(../fonts/TTNormsProRegular.otf)",name:"settingsHeaderFont"};async function qe(){try{var e,t=await fetch("/api/state/sessionValidation",{method:"GET"});if(t.ok)return e=await t.json(),Ot([_e,We,Ge,ze]),Je(e),e;throw new Error("HTTP error! status: "+t.status)}catch(e){throw e}}async function Je(e){e.isLoggedIn&&(C.loggedIn=!0,C.updatingState=!0,await Ke(e.user,e.note,e.sessions),C.updatingState=!1)}async function Ke(e,t,o){Ye(),Ze(e),$e(e),et(e),we(o),Qe(e),Xe(e),xt(t),Nt(t),Ue(o,t)}function Qe(e){e=e.showingTimeLeft;x.showingTimeLeft=e}function Xe(e){e=e.targetHours;void 0!==e&&(w.targetTime=60*e*60*1e3,Ae(e,w,E),je(he,Te,ne,pe,E,w,x),m.classList.toggle("small"),E.progressBarContainerIsSmall=!1)}function Ye(){document.getElementById("loginIcon").style.display="none",document.getElementById("logoutIcon").style.display="flex",document.getElementById("logInOutBtn").innerText="Log Out"}function Ze(e){document.getElementById("loginIcon2").style.display="none",document.getElementById("accountIconFinal").style.display="flex",document.getElementById("logInOutBtn2").innerText=e.email,document.getElementById("questionPopupUserEmail").innerText=e.email,e.logins<=1?document.getElementById("welcomeText").innerText="Welcome":document.getElementById("welcomeText").innerText="Welcome Back"}function $e(e){["noAccountText","accountOr1","settingsGoogleLogin","accountOr2","emailPasswordLoginMainContainer","loginBtnContainer"].forEach(e=>document.getElementById(e).style.display="none"),["userEmailContainer","logoutBtnContainer","accountHr","deleteAccountBtnContainer"].forEach(e=>document.getElementById(e).style.display="flex"),document.getElementById("userEmail").innerText=e.email}function et(e){tt(e),lt(e),gt(e),kt(e),vt(e),Bt(e),At(e)}function tt(e){ot(e),nt(e),at(e),st(e),it(e)}function ot(e){e=e.settings.pomodoro.notificationToggle;E.pomodoroNotificationToggle=e,t.checked=e}function nt(e){let o=e.settings.pomodoro["intervalArr"];w.pomodoroIntervalArr=o,n.forEach((e,t)=>{e.value=o[t]})}function at(e){var{autoStartPomToggle:e,autoStartBreakToggle:t}=e.settings.pomodoro;E.autoStartPomodoroInterval=e,V.checked=e,E.autoStartBreakInterval=t,M.checked=t}function st(e){e=e.settings.pomodoro.alertVolume;B.pomodoro=e,R.style.left=100*e+"%",U.style.left=100*e+"%"}function it(e){e=e.settings.pomodoro.alertSound;"none"===(S.pomodoro=e)?(o[0].checked=!0,o[3].checked=!0):"chime"===e?(o[1].checked=!0,o[4].checked=!0):"bell"===e&&(o[2].checked=!0,o[5].checked=!0)}function lt(e){ct(e),rt(e),dt(e),mt(e)}function ct(e){e=e.settings.chillTime.notificationToggle;E.flowmodoroNotificationToggle=e,H.checked=e}function rt(e){let o=e.settings.chillTime["intervalArr"];w.breakTimeSuggestionsArr=o,_.forEach((e,t)=>{e.value=o[t]})}function dt(e){e=e.settings.chillTime.alertVolume;B.flowmodoro=e,W.style.left=100*e+"%",G.style.left=100*e+"%"}function mt(e){e=e.settings.chillTime.alertSound;"none"===(S.flowmodoro=e)?(a[0].checked=!0,a[3].checked=!0):"chime"===e?(a[1].checked=!0,a[4].checked=!0):"bell"===e&&(a[2].checked=!0,a[5].checked=!0)}function gt(e){ut(e),ft(e),ht(e),Tt(e),pt(e,J)}function ut(e){e=e.settings.flowTime.notificationToggle;E.breakSuggestionToggle=e,z.checked=e}function ft(e){e=e.settings.flowTime.suggestionMinutes;w.suggestionMinutes=e,q.value=e}function ht(e){e=e.settings.flowTime.alertVolume;B.general=e,generalVolumeThumb.style.left=100*e+"%",generalVolumeThumb2.style.left=100*e+"%"}function Tt(e){e=e.settings.flowTime.alertSound;"none"===(S.general=e)?(s[0].checked=!0,s[3].checked=!0):"chime"===e?(s[1].checked=!0,s[4].checked=!0):"bell"===e&&(s[2].checked=!0,s[5].checked=!0)}function pt(e,t){e=e.settings.flowTime.targetTimeReachedToggle;E.targetReachedToggle=e,t.checked=e}function kt(e){yt(e),bt(e),It(e)}function yt(e){e=e.settings.backgroundsThemes.darkThemeActivated;E.darkThemeActivated=e,E.darkThemeActivated?(i.classList.add("selected-background"),l.classList.remove("selected-background"),me.style.display="flex",ge.style.display="none",Le(c,r,d,m,g,u,f,h,T,te,oe,j,L,p,y,ke)):(i.classList.remove("selected-background"),l.classList.add("selected-background"),Se(c,r,d,m,g,u,f,h,T,j,L,p,He,y,ye))}function bt(e){var{flowTimeBackground:e,chillTimeBackground:t,flowTimeBackgroundTemp:o,chillTimeBackgroundTemp:n}=e.settings.backgroundsThemes;L.flowtime=e,A.flowtime=ue[e],L.chilltime=t,A.chilltime=fe[t],j.flowtime=o,j.chilltime=n,document.getElementById("green-default").classList.remove("selected-background"),document.getElementById("blue-default").classList.remove("selected-background"),Be()}function It(e){var{flowTimeAnimation:e,chillTimeAnimation:t}=e.settings.backgroundsThemes;E.flowTimeAnimationToggle=e,K.checked=e,E.chillTimeAnimationToggle=t,Q.checked=t}function vt(e){Ct(e),Et(e),wt(e)}function Ct(e){e=e.settings.display.intervalTime;re.checked=e,xe()}function Et(e){e=e.settings.display.totalTime;de.checked=e,Ne()}function wt(e){e=e.settings.display.muffinToggle;v.checked=e,v.checked?E.muffinToggle=!0:E.muffinToggle=!1}function Bt(e){St(e),Lt(e)}function St(e){e=e.settings.notes.autoSwitchToggle;N.transitionNotesAutoSwitchToggle=e,transitionNotesAutoSwitchToggle.checked=e}function Lt(e){e=e.settings.notes.propagateUnfinishedTasksToggle;N.propagateUnfinishedTasksToggle=e,ee.checked=e}function At(e){jt(e)}function jt(e){e=e.settings.sounds.transitionClockSound;E.transitionClockSoundToggle=e,X.checked=e}function xt(e){var t,o,n,a,s=k.getElementsByClassName("selection-tag");Array.from(s).forEach(e=>{e.remove(),delete F[e.id]});for([t,o]of Object.entries(e.labels).reverse()){var i=document.createElement("div"),l=(i.id=t,document.createElement("h4"));l.className="tag-text",l.textContent=o,i.appendChild(l),e.selectedLabels.hasOwnProperty(t)||(i.className="tag unselectable selection-tag",k.insertBefore(i,k.firstChild)),F[t]=o,D[o]=!1,Ee[o]=[]}for([n,a]of Object.entries(e.selectedLabels)){var c=document.createElement("div"),r=(c.id=n,document.createElement("h4"));r.className="tag-text",r.textContent=a,c.appendChild(r),c.className="tag unselectable selected-tag",c.firstElementChild.style.backgroundColor="rgba(255, 255, 255, 0.2)",P.tagsSelected++,De(P,b),b.appendChild(c),(b.scrollWidth>b.clientWidth||O.currentLabelInputTagSize<20)&&(Re(O,ve,Ce,b),b.scrollWidth>b.clientWidth)&&(b.style.justifyContent="left"),Ie[n]=a,D[a]=!0}let d=Pt(F);Object.keys(F).forEach(e=>delete F[e]),Object.keys(d).forEach(e=>F[e]=d[e]),0<P.tagsSelected&&(Ve(N,ae,I,se),ce.style.display="none",I.style.zIndex=3),Me(ie,le,N),P.lastLabelIdNum=e.lastLabelIdNum,O.lastSelectedEmojiId=e.lastSelectedEmojiId;s=document.getElementById(O.lastSelectedEmojiId).src;Y.src=s,Z.src=s}function Nt(e){var t=e.noteTasks;for(let e=0;e<t.length;e++){var o=document.createElement("div"),n=t[e].id,n=(o.id=n,o.setAttribute("data-testid",n),Fe(o.id)),a=t[e].classList;for(let e=0;e<a.length;e++)o.classList.add(a[e]);a.includes("task")&&(i=Oe({lastTaskInputIdNum:n}),o.appendChild(i),i=o.querySelector("#"+("check"+n)),s=o.firstElementChild,t[e].classList.includes("completed-task"))&&(s.style.backgroundColor="#3ba43e",i.setAttribute("stroke-width","3"),i.parentElement.parentElement.style.opacity="1",o.classList.add("completed-task"));var s=document.createElement("span"),i=(s.textContent=t[e].content,"spanText"+n),n=(s.setAttribute("data-testid",i),o.appendChild(s),Pe("Task",n)),n=(o.appendChild(n),$.appendChild(o),{id:o.id,classList:[...o.classList],content:s.textContent,date:t[e].date});be.push(n)}P.lastTaskInputIdNum=e.lastTaskInputIdNum}function Pt(e){e=Object.entries(e).reverse();return Object.fromEntries(e)}function Ot(t){for(let e=0;e<t.length;e++)new FontFace(t[e].name,t[e].path).load().then(function(e){document.fonts.add(e)}).catch(function(e){})}document.addEventListener("DOMContentLoaded",()=>{qe().catch(e=>{}).finally(()=>{document.dispatchEvent(new Event("stateUpdated"))})});