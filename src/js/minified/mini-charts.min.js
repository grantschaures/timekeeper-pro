import{miniCharts as g}from"../modules/dashboard-elements.js";import{dashboardData as r,dailyContainer as n,miniChartsArr as c,constants as b}from"../modules/dashboard-objects.js";import{sessionState as h}from"../modules/state-objects.js";import{getDeepWork as p,getFocusQuality as f,getTargetHours as y}from"./session-summary-chart.js";let C=[];function t(){let e=0;n.miniChartsSeen&&(e=1e3);for(let t=0;t<g.length;t++)a(t,e);n.miniChartsSeen=!0}function a(t,e){var a=g[t].id,a=document.getElementById(a).getContext("2d");let o,r=0,n=0,s=1e-16;(o=h.loggedIn?C[t]:null)&&(r=1-o.distractions/(o.deepWorkTime/6e4)/b.FOCUS_QUALITY_CONSTANT,n=o.deepWorkTime,s=o.targetHourSum);var i=f(r),l=100-i,d=p(n);let u=y(s)-d;u<0&&(u=0);var m=Math.floor(d),m=(Math.round(60*(d-m)),n<6e4&&Math.floor(n/1e3),{datasets:[{label:"Focus Quality",data:[i,l],backgroundColor:["rgba(59, 143, 227, 1)","rgba(59, 143, 227, 0.15)"],borderColor:["rgba(255, 255, 255, 1)","rgba(255, 255, 255, 1)"],borderWidth:0},{label:"Deep Work",data:[d,u],backgroundColor:["rgba(83, 230, 88, 1)","rgba(83, 230, 88, 0.15)"],borderColor:["rgba(255, 255, 255, 1)","rgba(255, 255, 255, 1)"],borderWidth:0}]}),i={type:"doughnut",data:m,options:{responsive:!0,maintainAspectRatio:!0,cutout:"40%",animation:{duration:e,animateRotate:!0,animateScale:!1},plugins:{legend:!1,tooltip:!1},layout:{padding:0}}};c[t]&&(c[t].destroy(),c[t]=null),c[t]=new Chart(a,i)}async function e(){var t=s(r.weeklyArr,n.lowerBound);let e;e=t?t[n.lowerBound]:[null,null,null,null,null,null,null];var a=[],o={};for(let t=0;t<e.length;t++)o={},e[t]?(o.deepWorkTime=e[t].deepWorkTime,o.distractions=e[t].distractions,o.targetHourSum=e[t].targetHourSum,a.push(o)):a[t]=e[t];C=a}function s(t,e){return t.find(t=>Object.keys(t)[0]===e)}async function o(){C=[]}document.addEventListener("displayMiniCharts",async function(){await o(),await e(),t()});