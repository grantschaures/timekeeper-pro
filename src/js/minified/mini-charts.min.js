import{miniCharts as c}from"../modules/dashboard-elements.js";import{dashboardData as n,dailyContainer as i,miniChartsArr as g,constants as y,flags as s}from"../modules/dashboard-objects.js";import{sessionState as b}from"../modules/state-objects.js";import{getDeepWork as p,getFocusQuality as h,getTargetHours as f}from"./session-summary-chart.js";let C=[];function a(){let t=0;i.miniChartsSeen&&(t=1e3);for(let a=0;a<c.length;a++)e(a,t);i.miniChartsSeen=!0}function e(a,t){var e=c[a].id,e=document.getElementById(e).getContext("2d");let r,o=0,n=0,i=1e-16;(r=b.loggedIn?C[a]:null)&&((o=1-r.distractions/(r.deepWorkTime/6e4)/y.FOCUS_QUALITY_CONSTANT)<0&&(o=0),n=r.deepWorkTime,i=r.targetHourSum);var s=h(o),d=100-s,l=p(n);let u=f(i)-l;u<0&&(u=0);var m=Math.floor(l),m=(Math.round(60*(l-m)),n<6e4&&Math.floor(n/1e3),{datasets:[{label:"Focus Quality",data:[s,d],backgroundColor:["rgba(59, 143, 227, 1)","rgba(59, 143, 227, 0.15)"],borderColor:["rgba(255, 255, 255, 1)","rgba(255, 255, 255, 1)"],borderWidth:0},{label:"Deep Work",data:[l,u],backgroundColor:["rgba(83, 230, 88, 1)","rgba(83, 230, 88, 0.15)"],borderColor:["rgba(255, 255, 255, 1)","rgba(255, 255, 255, 1)"],borderWidth:0}]}),s={type:"doughnut",data:m,options:{responsive:!0,maintainAspectRatio:!0,cutout:"40%",animation:{duration:t,animateRotate:!0,animateScale:!1},plugins:{legend:!1,tooltip:!1},layout:{padding:0}}};g[a]&&(g[a].destroy(),g[a]=null),g[a]=new Chart(e,s)}async function t(){var a=d(n.weeklyArr,i.lowerBound);let t;var e={dailyData:null,noteEntryData:null},r=(t=a?a[i.lowerBound]:[e,e,e,e,e,e,e],n.currentWeekArr=t,s.dailyArrowClicked?s.dailyArrowClicked=!1:document.dispatchEvent(new Event("displayDayView")),[]),o={};for(let a=0;a<t.length;a++)o={},t[a].dailyData?(o.deepWorkTime=t[a].dailyData.deepWorkTime,o.distractions=t[a].dailyData.distractions,o.targetHourSum=t[a].dailyData.targetHourSum,r.push(o)):r[a]=null;C=r}function d(a,t){return a.find(a=>Object.keys(a)[0]===t)}async function r(){C=[]}document.addEventListener("displayMiniCharts",async function(){await r(),await t(),a()});