import{charts as i,dashboardData as e,flags as l,constants as a,general as t}from"../modules/dashboard-objects.js";import{timeConvert as o}from"../modules/index-objects.js";import{calculateDistractionsPerHour as s,focusQualityCalculation as d}from"../dashboard/populate-dashboard.js";let n=[],m=[],u=[],c=[],p=["1am","2am","3am","4am","5am","6am","7am","8am","9am","10am","11am","12pm","1pm","2pm","3pm","4pm","5pm","6pm","7pm","8pm","9pm","10pm","11pm","12am"],g=a.FOCUS_QUALITY_CONSTANT;async function r(){n=[],m=[],u=[]}function h(){let a="rgba(63, 210, 68, 1)",e=(l.hourlyQualityAdjustedToggle&&(a="#0cce63"),u);l.hourlyQualityAdjustedToggle&&(e=c);var t=document.getElementById("avgDeepWorkChart").getContext("2d"),r={type:"bar",data:{labels:["12am","1am","2am","3am","4am","5am","6am","7am","8am","9am","10am","11am","12pm","1pm","2pm","3pm","4pm","5pm","6pm","7pm","8pm","9pm","10pm","11pm"],datasets:[{label:"Avg Deep Work (Min)",data:e,backgroundColor:a,borderColor:"rgb(255, 255, 255)",borderWidth:2,borderRadius:5,barPercentage:1,categoryPercentage:1,offset:!0}]},options:{scales:{y:{beginAtZero:!0,max:60,title:{display:!0,text:"Avg Deep Work (Min)",color:"white"},ticks:{color:"white"},grid:{display:!0,color:"rgba(255, 255, 255, 0.15)",lineWidth:1,drawBorder:!0,drawOnChartArea:!0,drawTicks:!1}},x:{offset:!0,ticks:{align:"end",color:"white"},title:{display:!1}}},plugins:{legend:{display:!1},tooltip:{enabled:!0,backgroundColor:"rgb(0, 0, 0)",titleColor:"white",bodyColor:"white",borderColor:"white",borderWidth:3,callbacks:{title:function(a){var a=a[0],e=a.dataIndex,e=p[e];return a.label+" - "+e},label:function(a){let e;return e=l.hourlyQualityAdjustedToggle?" "+a.raw+" min adjusted avg deep work":" "+a.raw+" min avg deep work"}}}},animations:{x:{duration:0},y:{duration:l.quickerChartAnimations?500:1e3,easing:"easeOutQuint"}}},plugins:[y]};i.avgDeepWork&&(i.avgDeepWork.destroy(),i.avgDeepWork=null),i.avgDeepWork=new Chart(t,r)}function b(){let a,e,t;t=l.distractionsToggle?(a="rgb(255, 69, 0)",e=m,{beginAtZero:!0,suggestedMax:5,title:{display:!0,text:"Avg Distractions (Per Hour of Deep Work)",color:"white"},ticks:{color:"white"},grid:{display:!0,color:"rgba(255, 255, 255, 0.15)",lineWidth:1,drawBorder:!0,drawOnChartArea:!0,drawTicks:!1}}):(a="rgb(162, 0, 212)",e=n,{beginAtZero:!0,max:100,title:{display:!0,text:"Hourly Focus Quality",color:"white"},ticks:{color:"white"},grid:{display:!0,color:"rgba(255, 255, 255, 0.15)",lineWidth:1,drawBorder:!0,drawOnChartArea:!0,drawTicks:!1}});var r=document.getElementById("hourlyFocusChart").getContext("2d"),o={type:"bar",data:{labels:["12am","1am","2am","3am","4am","5am","6am","7am","8am","9am","10am","11am","12pm","1pm","2pm","3pm","4pm","5pm","6pm","7pm","8pm","9pm","10pm","11pm"],datasets:[{label:"Hourly Focus Quality",data:e,backgroundColor:a,borderColor:"rgb(255, 255, 255)",borderWidth:2,borderRadius:5,barPercentage:1,categoryPercentage:1,offset:!0}]},options:{scales:{y:t,x:{offset:!0,ticks:{align:"end",color:"white"},title:{display:!1}}},plugins:{legend:{display:!1},tooltip:{enabled:!0,backgroundColor:"rgb(0, 0, 0)",titleColor:"white",bodyColor:"white",borderColor:"white",borderWidth:3,callbacks:{title:function(a){var a=a[0],e=a.dataIndex,e=p[e];return a.label+" - "+e},label:function(a){let e;return e=l.distractionsToggle?" "+a.raw+" avg distractions per hour of deep work":" "+a.raw+"%"}}}},animations:{x:{duration:0},y:{duration:l.quickerChartAnimations?500:1e3,easing:"easeOutQuint"}}},plugins:[y]};i.hourlyFocus&&(i.hourlyFocus.destroy(),i.hourlyFocus=null),i.hourlyFocus=new Chart(r,o)}document.addEventListener("displayAdvCharts",async function(){await r(),await initializeHourlyData(e,n,m,u);var a=t.chartTransition;"all"!==a&&"adv-adjusted"!==a||h(),"all"!==a&&"adv-distractions"!==a||b()});let y={id:"dottedLinePlugin",afterDraw:function(a){var e=a.ctx,t=a.scales.x,a=a.scales.y,t=(t.getPixelForValue(11)+t.getPixelForValue(12))/2;e.save(),e.setLineDash([5,5]),e.strokeStyle="rgba(255, 255, 255, 0.15)",e.lineWidth=2,e.beginPath(),e.moveTo(t,a.top),e.lineTo(t,a.bottom),e.stroke(),e.restore()}};async function initializeHourlyData(a){var e=a.hourlyArr;for(let a=0;a<e.length;a++){var t=d(o,e[a].deepWork,e[a].distractions,g),r=(n.push(Math.round(100*t)),s(o,e[a].deepWork,e[a].distractions)),r=(m.push(r),w(e[a].deepWorkTimes)),r=(u.push(Math.round(r)),Math.round(r*t));c.push(r)}return c}function w(a){let e=a.reduce((a,e)=>a+e,0)/a.length/o.msPerMin;return e=isNaN(e)?0:e}export{initializeHourlyData};