import{charts as n,mainChartContainer as c,dashboardData as e,flags as y}from"../modules/dashboard-objects.js";import{timeConvert as i}from"../modules/index-objects.js";let l=[],s=[],d=[],w=[],h=[],g=[],o=.5,u={deepWork:0,avgInterval:0},M=[],p=["Sun","Mon","Tue","Wed","Thur","Fri","Sat"],m=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],C={week:p,month:[],year:m};function b(e){var t=Math.floor(e),e=Math.round(60*(e-t));return(t%12==0?12:t%12)+`:${e<10?"0"+e:e} `+(t<12||24===t?"AM":"PM")}async function t(){var t=e.sessionArr;for(let e=0;e<t.length;e++){var r=moment.tz(t[e].startTime,t[e].timeZone).format(),a=moment.tz(t[e].endTime,t[e].timeZone).format();moment(a,"YYYY-MM-DD").isSameOrAfter(moment(c.lowerBound,"YYYY-MM-DD"))&&moment(r,"YYYY-MM-DD").isSameOrBefore(moment(c.upperBound,"YYYY-MM-DD"))&&v(r,a,k(r,t[e].deepWorkIntervals,t[e].breakIntervals))}}function v(t,r,a){for(let e=0;e<a.length-1;e++){var o=f(t,c.timeFrame),n=f(r,c.timeFrame),i=e%2==0?h:g,l=moment(t,"YYYY-MM-DD").isBefore(moment(c.lowerBound,"YYYY-MM-DD")),s=moment(r,"YYYY-MM-DD").isAfter(moment(c.upperBound,"YYYY-MM-DD")),d=a[e],u=a[e+1];l?24<u&&(d<24?i.push({x:n,y:[0,u-24]}):i.push({x:n,y:[d-24,u-24]})):s?d<24&&(24<u?i.push({x:o,y:[d,24]}):i.push({x:o,y:[d,u]})):24<d&&24<u?i.push({x:n,y:[d-24,u-24]}):24<u?(i.push({x:o,y:[d,24]}),i.push({x:n,y:[0,u-24]})):i.push({x:o,y:[d,u]})}}function f(e,t){e=new Date(e);return"week"===t?["Sun","Mon","Tue","Wed","Thur","Fri","Sat"][e.getDay()]:"month"===t?e.getDate().toString():"year"===t?["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()]:null}function k(e,t,r){var a=x(t,r),o=[];let n=D(e);o.push(n);for(let e=0;e<a.length;e++)n+=a[e]/i.msPerHour,o.push(n);return o}function D(e){e=moment.parseZone(e);return e.hours()+e.minutes()/60+e.seconds()/3600}function x(t,r){var a=[];for(let e=0;e<t.length;e++)a.push(t[e]),r[e]&&a.push(r[e]);return a}async function r(){l=[],s=[],d=[],w=[],h=[],g=[],Object.keys(u).forEach(e=>{u[e]=0}),M=[],C.month=[]}async function a(e,r,a,o,n,i){var l=[0,0,0,0,0,0,0,0,0,0,0,0],s=[0,0,0,0,0,0,0,0,0,0,0,0],d=[[],[],[],[],[],[],[],[],[],[],[],[]],t=e.dailyArr;for(let e=0;e<t.length;e++){var u=t[e].date;if(moment(u,"YYYY-MM-DD").isSameOrAfter(moment(r.lowerBound,"YYYY-MM-DD"))&&moment(u,"YYYY-MM-DD").isSameOrBefore(moment(r.upperBound,"YYYY-MM-DD"))){var c=T(t[e])[0],h=T(t[e])[1],g=S(t[e]),p=Q(u);if("week"===r.timeFrame){for(var m=B(u);a.length<m;)a.push(0),o.push(0),n.push(0);A(p,m)}else if("month"===r.timeFrame){for(var b=F(u);a.length<b;)a.push(0),o.push(0),n.push(0);A(p,b)}else{p=W(u);l[p]+=t[e].deepWorkTime,s[p]+=t[e].distractions,y.avgBreakIntervalToggle?d[p].push(...t[e].breakIntervals):d[p].push(...t[e].deepWorkIntervals)}"year"!==r.timeFrame&&(a.push(c),o.push(Math.floor(100*h)),n.push(g))}}if("month"===r.timeFrame&&(e=N(r.lowerBound),C.month=J(e),w=I(r.lowerBound,C.month)),"year"===r.timeFrame){let t=!1;for(let e=i.avgInterval=0;e<12;e++){var v,f={deepWorkTime:l[e],distractions:s[e],deepWorkIntervals:d[e],breakIntervals:d[e]},k=(0!==l[e]?(k=T(f)[0],v=T(f)[1],f=S(f),a.push(k),o.push(Math.floor(100*v)),n.push(f),t=!0):(a.push(0),o.push(0),n.push(0)),Y(r.lowerBound,e));M.push(k)}t||(a.length=0,o.length=0,n.length=0)}i.deepWork=Z(i.deepWork),i.avgInterval=j(i.avgInterval)}function I(e,t){let[r,a]=e.split("-").map(Number),o=[];return t.forEach((e,t)=>{0===new Date(r,a-1,Number(e)).getDay()&&o.push(t)}),o}function Y(e,t){e=e.split("-")[0];return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t]+", "+e}function W(e){e=e.split("-")[1];return parseInt(e,10)-1}function A(e,t){if(M.length!==t)for(;M.length<t;)M.push("no data");M.push(e)}function F(e){var[e,t,r]=e.split("-").map(Number);return new Date(e,t-1,r).getDate()-1}function B(e){var[e,t,r]=e.split("-").map(Number);return new Date(e,t-1,r).getDay()}function J(t){var r=[];for(let e=1;e<=t;e++)r.push(String(e));return r}function N(e){var[e,t]=e.split("-").map(Number);return new Date(e,t,0).getDate()}function Q(e){var[,t,r]=e.split("-"),t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][parseInt(t)-1];r=parseInt(r)+function(e){if(3<e&&e<21)return"th";switch(e%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}}(parseInt(r)),e=B(e);return C.week[e]+`, ${t} `+r}function Z(e){let t=Math.ceil(e);return L(t)&&2<t&&t++,t}function j(e){return 2*Math.ceil(e/2)}function L(t){if(t<=1)return!1;if(!(t<=3)){if(t%2==0||t%3==0)return!1;for(let e=5;e*e<=t;e+=6)if(t%e==0||t%(e+2)==0)return!1}return!0}function S(e){let t;t=y.avgBreakIntervalToggle?e.breakIntervals.reduce((e,t)=>e+t,0)/e.breakIntervals.length:e.deepWorkIntervals.reduce((e,t)=>e+t,0)/e.deepWorkIntervals.length;e=Math.round(t/i.msPerMin);return e>u.avgInterval&&(u.avgInterval=e),e}function T(e){let t=e.deepWorkTime/i.msPerHour;var r=60*t;t>u.deepWork&&(u.deepWork=t);let a=1-e.distractions/r/o;return a<0?a=0:isNaN(a)&&(a=1),y.adjustedDeepWorkToggle&&(t*=a),[t,a]}function z(){let e;e="week"===c.timeFrame?C.week:"month"===c.timeFrame?C.month:C.year;let t;t=y.adjustedDeepWorkToggle?"#0cce63":"rgba(63, 210, 68, 1)",u.deepWork<6&&(u.deepWork=6),0===l.length&&(u.deepWork=0);var r=document.getElementById("deepWorkChart").getContext("2d"),a={type:"bar",data:{labels:e,datasets:[{label:"Deep Work Hours",data:l,backgroundColor:t,borderColor:"rgb(255, 255, 255)",borderRadius:25,borderSkipped:!1,barPercentage:1,categoryPercentage:.5}]},options:{scales:{y:{beginAtZero:!0,max:u.deepWork,title:{display:!0,text:"Deep Work Hours",color:"white"},ticks:{color:"white",stepSize:1},grid:{display:!0,color:"rgba(255, 255, 255, 0.15)",lineWidth:1,drawBorder:!0,drawOnChartArea:!0,drawTicks:!1}},x:{title:{display:!1},ticks:{color:"white"}}},plugins:{legend:{display:!1},tooltip:{enabled:!0,backgroundColor:"rgb(0, 0, 0)",titleColor:"white",bodyColor:"white",borderColor:"white",borderWidth:2,callbacks:{title:function(e){e=e[0].dataIndex;return""+M[e]},label:function(e){var t=Math.floor(e.raw);return` ${t}h ${Math.round(60*(e.raw-t))}m`}}}},animations:{x:{duration:0},y:{duration:y.quickerChartAnimations?500:1e3,easing:"easeOutQuint"}}},plugins:[P,O]};n.deepWork&&(n.deepWork.destroy(),n.deepWork=null),n.deepWork=new Chart(r,a)}function E(){let e;if("week"===c.timeFrame)e=C.week;else if("month"===c.timeFrame){e=C.month;for(let e=0;e<s.length;e++)"no data"===M[e]&&(s[e]=null)}else e=C.year;let t="bar";"month"===c.timeFrame&&(t="line");let r={beginAtZero:!0,suggestedMax:100,title:{display:!0,text:"Focus Quality %",color:"white"},ticks:{color:"white"},grid:{display:!0,color:"rgba(255, 255, 255, 0.15)",lineWidth:1,drawBorder:!0,drawOnChartArea:!0,drawTicks:!1}};0===s.length&&(r={beginAtZero:!0,max:0,title:{display:!0,text:"Focus Quality %",color:"white"},ticks:{color:"white"},grid:{display:!0,color:"rgba(255, 255, 255, 0.15)",lineWidth:1,drawBorder:!0,drawOnChartArea:!0,drawTicks:!1}});var a=document.getElementById("focusQualityChart").getContext("2d"),o={type:t,data:{labels:e,datasets:[{label:"Focus Quality %",data:s,backgroundColor:"rgb(162, 0, 212)",borderColor:"rgb(255, 255, 255)",borderRadius:25,borderSkipped:!1,barPercentage:1,categoryPercentage:.5,pointRadius:5,pointHoverRadius:8,spanGaps:!0}]},options:{scales:{y:r,x:{title:{display:!1},ticks:{color:"white"}}},plugins:{legend:{display:!1},tooltip:{enabled:!0,backgroundColor:"rgb(0, 0, 0)",titleColor:"white",bodyColor:"white",borderColor:"white",borderWidth:2,callbacks:{title:function(e){e=e[0].dataIndex;return""+M[e]},label:function(e){var t=e.dataIndex;return"no data"===M[t]?null:` ${e.raw}%`}}}},animations:{x:{duration:0},y:{duration:y.quickerChartAnimations?500:1e3,easing:"easeOutQuint"}}},plugins:[P,O]};n.focusQuality&&(n.focusQuality.destroy(),n.focusQuality=null),n.focusQuality=new Chart(a,o)}function R(){let e;e="week"===c.timeFrame?C.week:"month"===c.timeFrame?C.month:C.year;let t;t=y.avgBreakIntervalToggle?"rgba(59, 143, 227, 1)":"rgba(83, 230, 88, 1)";var r={beginAtZero:!0,max:u.avgInterval,title:{display:!0,text:"Interval Length (Min)",color:"white"},ticks:{color:"white",stepSize:10},grid:{display:!0,color:"rgba(255, 255, 255, 0.15)",lineWidth:1,drawBorder:!0,drawOnChartArea:!0,drawTicks:!1}};let a={beginAtZero:!0,suggestedMax:u.avgInterval,title:{display:!0,text:"Interval Length (Min)",color:"white"},ticks:{color:"white",stepSize:10},grid:{display:!0,color:"rgba(255, 255, 255, 0.15)",lineWidth:1,drawBorder:!0,drawOnChartArea:!0,drawTicks:!1}};u.avgInterval<60&&(u.avgInterval=60,r.max=u.avgInterval,a=r),0===d.length&&(a={beginAtZero:!0,max:0,title:{display:!0,text:"Interval Length (Min)",color:"white"},ticks:{color:"white",stepSize:10},grid:{display:!0,color:"rgba(255, 255, 255, 0.15)",lineWidth:1,drawBorder:!0,drawOnChartArea:!0,drawTicks:!1}});var r=document.getElementById("avgIntervalChart").getContext("2d"),o={type:"bar",data:{labels:e,datasets:[{label:"Interval Length (Min)",data:d,backgroundColor:t,borderColor:"rgb(255, 255, 255)",borderRadius:25,borderSkipped:!1,barPercentage:1,categoryPercentage:.5}]},options:{scales:{y:a,x:{title:{display:!1},ticks:{color:"white"}}},plugins:{legend:{display:!1},tooltip:{enabled:!0,backgroundColor:"rgb(0, 0, 0)",titleColor:"white",bodyColor:"white",borderColor:"white",borderWidth:2,callbacks:{title:function(e){e=e[0].dataIndex;return""+M[e]},label:function(e){return` ${e.raw}m`}}}},animations:{x:{duration:0},y:{duration:y.quickerChartAnimations?500:1e3,easing:"easeOutQuint"}}},plugins:[P,O]};n.avgInterval&&(n.avgInterval.destroy(),n.avgInterval=null),n.avgInterval=new Chart(r,o)}function $(){let e;var t={labels:e="week"===c.timeFrame?C.week:"month"===c.timeFrame?C.month:C.year,datasets:[{label:"Deep Work",data:h,backgroundColor:"rgba(63, 210, 68, 1)",borderColor:"rgb(255, 255, 255)",borderRadius:0,borderSkipped:!1},{label:"Break",data:g,backgroundColor:"rgba(59, 143, 227, 1)",borderColor:"rgb(255, 255, 255)",borderRadius:0,borderSkipped:!1}]};let r=[],a=(r="week"===c.timeFrame?p:"month"===c.timeFrame?C.month:m,24);0===h.length&&(a=0);var o=document.getElementById("sessionIntervalsChart").getContext("2d"),t={type:"bar",data:t,options:{scales:{y:{beginAtZero:!0,min:0,max:a,reverse:!0,title:{display:!0,text:"Day",color:"white"},ticks:{stepSize:3,color:"white",callback:function(e){return 0===e||24===e?"12 AM":3===e?"3 AM":6===e?"6 AM":9===e?"9 AM":12===e?"12 PM":15===e?"3 PM":18===e?"6 PM":21===e?"9 PM":""}},grid:{display:!0,color:"rgba(255, 255, 255, 0.15)",lineWidth:1,drawBorder:!0,drawOnChartArea:!0,drawTicks:!1}},x:{stacked:!0,title:{display:!1},ticks:{color:"white"}}},plugins:{legend:{display:!0},tooltip:{enabled:!0,backgroundColor:"rgb(0, 0, 0)",titleColor:"white",bodyColor:"white",borderColor:"white",borderWidth:2,callbacks:{title:function(e){e=e.map(e=>e.label||e.xLabel).join(", "),e=r.indexOf(e);return""+M[e]},label:function(e){return` ${b(e.raw.y[0])} - `+b(e.raw.y[1])}}}},animations:!1},plugins:[P,O]};n.sessionIntervals&&(n.sessionIntervals.destroy(),n.sessionIntervals=null),n.sessionIntervals=new Chart(o,t)}document.addEventListener("displayMainCharts",async function(){await r(),await a(e,c,l,s,d,u),z(),E(),R(),y.quickerChartAnimations=!0,await t(),$()});let O={id:"dottedLinePlugin",afterDraw:function(e){if("month"===c.timeFrame&&0<l.length){var t=e.ctx,r=e.scales.x,a=e.scales.y;for(let e=0;e<w.length;e++){var o=w[e],o=(r.getPixelForValue(o-1)+r.getPixelForValue(o))/2;t.save(),t.setLineDash([5,5]),t.strokeStyle="rgba(255, 255, 255, 0.15)",t.lineWidth=2,t.beginPath(),t.moveTo(o,a.top),t.lineTo(o,a.bottom),t.stroke(),t.restore()}}}},P={id:"noDataPlugin",afterDraw:function(e){var t,r;0!==e.data.datasets[0].data.length&&!e.data.datasets[0].data.every(e=>null===e)||(t=e.ctx,r=e.width,e=e.height,t.save(),t.textAlign="center",t.textBaseline="middle",t.font="48px settingsHeaderFont",t.fillStyle="gray",t.fillText("No Data 😩",r/2,e/2-20),t.restore())}};