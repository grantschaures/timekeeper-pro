import{confirmSessionDeletionNoBtn as e,confirmSessionDeletionPopup as t,confirmSessionDeletionYesBtn as s,dayViewContainer as l,dayViewSessionsContainer as H,percentTimeInDeepWorkStat as r,pomodoroCountStat as d,sessionDurationStat as c,sessionTitle as u,sessionToDeleteContainer as n,sessionViewBackBtn as i,sessionViewCommentsTextArea as m,sessionViewContainer as p,sessionViewHeaderContainer as I,sessionViewLabelsContainer as y,sessionViewNoLabelsContainer as N,sessionViewSessionContainer as f,sessionViewSubjectiveFeedbackDropdown as h,sessionViewTrashIcon as o}from"../modules/dashboard-elements.js";import{dashboardData as v,flags as L}from"../modules/dashboard-objects.js";import{body as a,confirmLabelDeletionYesBtn as P,popupOverlay as w,subjectiveFeedbackDropdown as W}from"../modules/dom-elements.js";import{updateSessionSummaryData as b}from"../state/update-session-summary-data.js";import{deleteSession as T}from"../state/delete-session.js";import{getDeepWork as C}from"./session-summary-chart.js";let g,D;function hideConfirmSessionDeletionPopup(){L.confirmSessionDeletionPopupShowing=!1,w.style.display="none",t.style.display="none",a.style.overflowY="scroll",n.removeChild(n.firstChild)}function S(){L.confirmSessionDeletionPopupShowing=!0,w.style.display="flex",t.style.display="block",a.style.overflowY="hidden",x()}function x(){D.style.backgroundColor="black",D.style.color="white",D.style.fontFamily="settingsHeaderFont",D.style.marginBottom="15px",n.appendChild(D)}async function initializeSessionView(e,t,s){await F(),await V(e,t),E(e,t,s)}async function V(e,t){g=e,D=t.cloneNode(!0)}function E(e,t,s){L.sessionViewContainerShowing=!0,dailyBodyContainer.scrollTo(0,0),l.style.display="none",l.style.opacity="0",p.style.display="flex",setTimeout(()=>{p.style.opacity="1"},0),u.innerText="Session #"+s,t.classList.add("no-select"),f.appendChild(t);var n,s=e.sessionSummary.comments,t=(m.value=s,e.sessionSummary.subjectiveFeedback),i=(h.value=t,[]),o=e.labelTimes;for(n in o)o.hasOwnProperty(n)&&0<o[n]&&i.push({id:n,time:o[n]});j(i);var s=e.startTime,t=e.endTime,a=B(s,t).totalDurationMs,s=B(s,t).totalDurationStr,t=(c.innerText=s,e.totalDeepWork),s=k(a,t),a=(r.innerText=s+"%",e.pomodorosCompleted);d.innerText=a}function k(e,t){let s=Math.round(t/e*100);return s=100<s?100:s}function B(e,t){e=new Date(e),t=new Date(t)-e;return{totalDurationMs:t,totalDurationStr:M(t)}}function j(s){var e=v.noteData.labels,t=v.noteData.deletedLabels,n={...e,...t};if(0===s.length){e=document.createElement("div");e.classList.add("sessionViewNoLabelsContainer"),e.innerText="No Labels",y.appendChild(e)}else for(let e=0;e<s.length;e++){var i=n[s[e].id],o="| "+M(s[e].time),a=document.createElement("div");a.classList.add("sessionViewLabelContainer");let t=document.createElement("div");t.classList.add("sessionViewLabel"),t.innerText=i,t.id="sessionViewLabel"+e;i=document.createElement("div");i.classList.add("sessionViewLabelTime"),i.innerText=o,a.appendChild(t),a.appendChild(i),y.appendChild(a),setTimeout(()=>{if(200<document.getElementById(t.id).offsetWidth){let e=document.getElementById(t.id).innerText;e=e.slice(0,10)+"...",document.getElementById(t.id).innerText=e}},0)}}function M(e){var t=C(e),s=Math.floor(t),t=Math.round(60*(t-s));let n;e<6e4&&(n=Math.floor(e/1e3));let i;return i=n?n+"s":s+`h ${t}m`}async function F(){f.innerHTML="",y.innerHTML="",c.innerText="",r.innerText="",d.innerText="",n.innerHTML=""}document.addEventListener("stateUpdated",async function(){i.addEventListener("mouseover",function(){i.classList.remove("resetBounce"),i.classList.add("triggerBounceLeft")}),i.addEventListener("mouseout",function(){i.classList.remove("triggerBounceLeft"),i.classList.add("resetBounce")}),i.addEventListener("click",function(e){L.sessionViewContainerShowing=!1,e.stopPropagation(),p.style.display="none",p.style.opacity="0",l.style.display="flex",setTimeout(()=>{l.style.opacity="1"},0)}),m.addEventListener("input",function(){this.style.height="auto",this.style.height=this.scrollHeight+"px"}),o.addEventListener("click",function(){S()}),e.addEventListener("click",function(){hideConfirmSessionDeletionPopup()}),s.addEventListener("click",async function(){hideConfirmSessionDeletionPopup(),await T(g._id),i.click()}),m.addEventListener("blur",function(){var e={type:"comments",value:m.value};b(g._id,e)}),h.addEventListener("change",function(e){var t={type:"subjectiveFeedback",value:h.value};b(g._id,t)})});export{hideConfirmSessionDeletionPopup,initializeSessionView};